import{j as e}from"./components-core-shESZ42s.js";import{r as c,af as w,ag as y,ah as v,ai as I,T as S,S as C,aj as k,w as u,ak as D,C as A,c as p,ab as $,O as R}from"./vendor-icons-BfFyJf5y.js";import{h as _}from"./components-features-B_8UeEdy.js";import"./vendor-react-OvXVS5lI.js";import"./components-dashboard-CcEQzuZE.js";import"./vendor-charts-Cy59uob1.js";function O(){const[h,o]=c.useState([]),[a,d]=c.useState(null),[r,j]=c.useState(""),[l,x]=c.useState("all");c.useEffect(()=>{(async()=>{const i=await _.getIncidents();o(i)})()},[]);const m=l==="all"?h:h.filter(s=>s.status===l),g={New:m.filter(s=>s.status==="New"),Investigating:m.filter(s=>s.status==="Investigating"),Resolved:m.filter(s=>s.status==="Resolved"),"False Positive":m.filter(s=>s.status==="False Positive")},b=(s,i)=>{o(t=>t.map(n=>{if(n.id===s){const f={id:`t-${Date.now()}`,type:"status_change",user:"You",timestamp:new Date().toISOString(),content:`Status changed from ${n.status} to ${i}`};return{...n,status:i,timeline:[f,...n.timeline]}}return n})),a&&a.id===s&&d(t=>t?{...t,status:i}:null)},N=()=>{if(!a||!r.trim())return;const s={id:`c-${Date.now()}`,type:"comment",user:"You",timestamp:new Date().toISOString(),content:r};o(i=>i.map(t=>t.id===a.id?{...t,timeline:[s,...t.timeline]}:t)),d(i=>i?{...i,timeline:[s,...i.timeline]}:null),j("")};return a?e.jsxs("div",{className:"incident-detail-container",children:[e.jsxs("div",{className:"detail-main",children:[e.jsxs("div",{className:"detail-header-card",children:[e.jsxs("div",{className:"header-top",children:[e.jsxs("div",{children:[e.jsxs("button",{className:"btn-text mb-2 flex items-center gap-1 text-sm text-muted",onClick:()=>d(null),children:[e.jsx(w,{className:"w-4 h-4"})," Back to Board"]}),e.jsx("div",{className:"incident-id",children:a.id}),e.jsx("div",{className:"header-title",children:e.jsx("h2",{children:a.title})})]}),e.jsxs("div",{className:"header-actions",children:[e.jsxs("select",{className:"bg-slate-800 border border-slate-600 rounded px-3 py-1 text-sm",value:a.status,onChange:s=>b(a.id,s.target.value),children:[e.jsx("option",{value:"New",children:"New"}),e.jsx("option",{value:"Investigating",children:"Investigating"}),e.jsx("option",{value:"Resolved",children:"Resolved"}),e.jsx("option",{value:"False Positive",children:"False Positive"})]}),e.jsx("button",{className:"btn-icon",children:e.jsx(y,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"header-meta-grid",children:[e.jsxs("div",{className:"meta-item",children:[e.jsx("label",{children:"Severity"}),e.jsx("div",{children:e.jsx("span",{className:`badge ${a.severity}`,children:a.severity})})]}),e.jsxs("div",{className:"meta-item",children:[e.jsx("label",{children:"Assignee"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-4 h-4"}),a.assignee||"Unassigned"]})]}),e.jsxs("div",{className:"meta-item",children:[e.jsx("label",{children:"Created"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4"}),new Date(a.created_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"meta-item",children:[e.jsx("label",{children:"Related Alerts"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"w-4 h-4"}),a.related_alerts]})]})]})]}),e.jsxs("div",{className:"detail-section",children:[e.jsxs("div",{className:"section-title",children:[e.jsx(C,{className:"w-5 h-5"})," Description"]}),e.jsx("p",{className:"text-slate-300 leading-relaxed",children:a.description}),e.jsx("div",{className:"mt-4 flex gap-2",children:a.tags.map(s=>e.jsxs("span",{className:"tag flex items-center gap-1",children:[e.jsx(k,{className:"w-3 h-3"})," ",s]},s))})]}),e.jsxs("div",{className:"detail-section",children:[e.jsxs("div",{className:"section-title",children:[e.jsx(u,{className:"w-5 h-5"})," Affected Assets"]}),e.jsx("div",{className:"assets-list",children:a.affected_assets.map(s=>e.jsxs("div",{className:"asset-item",children:[e.jsx(u,{className:"w-4 h-4 text-blue-400"}),s]},s))})]})]}),e.jsxs("div",{className:"detail-sidebar",children:[e.jsx("div",{className:"sidebar-tabs",children:e.jsx("button",{className:"sidebar-tab active",children:"Timeline & Notes"})}),e.jsx("div",{className:"sidebar-content",children:a.timeline.map(s=>e.jsxs("div",{className:"timeline-item",children:[e.jsx("div",{className:"timeline-icon",children:s.type==="comment"?e.jsx(D,{className:"w-3 h-3"}):s.type==="status_change"?e.jsx(A,{className:"w-3 h-3"}):e.jsx(p,{className:"w-3 h-3"})}),e.jsxs("div",{className:"timeline-content",children:[e.jsxs("div",{className:"timeline-header",children:[e.jsx("span",{className:"timeline-user",children:s.user}),e.jsx("span",{className:"timeline-time",children:new Date(s.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("div",{className:"timeline-text",children:s.content})]})]},s.id))}),e.jsxs("div",{className:"comment-input-area",children:[e.jsx("textarea",{className:"comment-input",placeholder:"Add a note...",value:r,onChange:s=>j(s.target.value),onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),N())}}),e.jsx("button",{className:"btn-primary p-2 rounded",onClick:N,disabled:!r.trim(),children:e.jsx($,{className:"w-4 h-4"})})]})]})]}):e.jsxs("div",{className:"incident-board",children:[e.jsxs("div",{className:"board-header",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Incident Response Board"}),e.jsxs("div",{className:"board-filters",children:[e.jsx("button",{className:`btn-sm ${l==="all"?"btn-primary":"btn-secondary"}`,onClick:()=>x("all"),children:"All"}),e.jsx("button",{className:`btn-sm ${l==="New"?"btn-primary":"btn-secondary"}`,onClick:()=>x("New"),children:"New"}),e.jsx("button",{className:`btn-sm ${l==="Investigating"?"btn-primary":"btn-secondary"}`,onClick:()=>x("Investigating"),children:"Investigating"})]})]}),e.jsxs("button",{className:"btn-primary flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4"})," New Incident"]})]}),e.jsx("div",{className:"board-columns",children:Object.entries(g).map(([s,i])=>e.jsxs("div",{className:"board-column",children:[e.jsxs("div",{className:"column-header",children:[e.jsx("span",{children:s}),e.jsx("span",{className:"bg-slate-700 px-2 py-0.5 rounded text-xs",children:i.length})]}),i.map(t=>e.jsxs("div",{className:"incident-card",onClick:()=>d(t),children:[e.jsxs("div",{className:"card-header",children:[e.jsx("div",{className:"card-title",children:t.title}),e.jsx("span",{className:`badge ${t.severity}`,children:t.severity})]}),e.jsx("div",{className:"text-xs text-muted line-clamp-2",children:t.description}),e.jsxs("div",{className:"card-meta",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(v,{className:"w-3 h-3"})," ",t.assignee||"Unassigned"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(p,{className:"w-3 h-3"})," ",new Date(t.updated_at).toLocaleDateString()]})]})]},t.id))]},s))})]})}export{O as default};
