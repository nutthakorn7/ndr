import{j as e,L as S}from"./components-core-1jZtVtDL.js";import{r as l,T as A,b as T,X as D,F as v,L as C,S as $,C as E,c as f,d as k,D as R,A as I,P as B,e as L,Z as O}from"./vendor-icons-CSBxVeM_.js";const M="http://localhost:8081",w="http://localhost:8087",y="http://localhost:8088",g="http://localhost:8089";class q{constructor(){this.baseURL=M}async request(t,s={}){const i=localStorage.getItem("token"),d={"Content-Type":"application/json",...s.headers};i&&(d.Authorization=`Bearer ${i}`);try{const c=await fetch(`${this.baseURL}${t}`,{...s,headers:d});if(!c.ok)throw new Error(`API Error: ${c.status}`);return await c.json()}catch(c){throw console.error("API Request failed:",t,c),c}}async getDashboardStats(){return this.request("/analytics/dashboard")}async getTrafficStats(t="24h"){return this.request(`/stats/traffic?range=${t}`)}async getProtocolStats(){return this.request("/stats/protocols")}async getAlerts(t={}){const s=new URLSearchParams(t).toString();return this.request(`/alerts?${s}`)}async getAlertById(t){return this.request(`/alerts/${t}`)}async getCorrelatedAlerts(t){return this.request(`/alerts/${t}/chain`)}async updateAlertStatus(t,s){return this.request(`/alerts/${t}/status`,{method:"PUT",body:JSON.stringify({status:s})})}async addAlertNote(t,s){return this.request(`/alerts/${t}/notes`,{method:"POST",body:JSON.stringify({note:s})})}async searchEvents(t){return this.request("/events",{method:"POST",body:JSON.stringify(t)})}async getAssets(t={}){const s=new URLSearchParams(t).toString();return(await fetch(`${y}/assets?${s}`)).json()}async getAssetStats(){return(await fetch(`${y}/assets/stats`)).json()}async getAssetById(t){return(await fetch(`${y}/assets/${t}`)).json()}async getDetectionRules(){return this.request("/rules")}async getDetectionStats(){return this.request("/detections/stats")}async getPlaybooks(){return(await fetch(`${g}/playbooks`)).json()}async executePlaybook(t,s){return(await fetch(`${g}/playbooks/${t}/execute`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json()}async getExecutions(t={}){const s=new URLSearchParams(t).toString();return(await fetch(`${g}/executions?${s}`)).json()}async login(t,s){return(await fetch(`${w}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:s})})).json()}async getCurrentUser(){const t=localStorage.getItem("token");return t?(await fetch(`${w}/auth/me`,{headers:{Authorization:`Bearer ${t}`}})).json():null}}const N=new q;function U({alertId:r,onClose:t}){const[s,i]=l.useState(null),[d,c]=l.useState([]),[x,o]=l.useState(!0),[h,n]=l.useState("details"),[u,j]=l.useState("");l.useEffect(()=>{r&&(async()=>{try{o(!0);const[m,P]=await Promise.all([N.getAlertById(r),N.getCorrelatedAlerts(r).catch(()=>({chain:[]}))]);i(m),c(P.chain||[])}catch(m){console.warn("Failed to load alert from API, using mock data:",m),i({id:r,title:"Suspicious PowerShell Activity",rule_name:"Suspicious PowerShell Activity",severity:"critical",timestamp:new Date().toISOString(),src_ip:"192.168.1.105",dst_ip:"10.0.0.5",dst_port:445,protocol:"TCP",description:"Detected execution of encoded PowerShell command associated with known malware loaders. The command attempts to download a payload from an external IP.",mitre_tactic:"Execution",mitre_technique:"Command and Scripting Interpreter",risk_score:90,status:"open",notes:[{author:"System",content:"Automatically flagged by detection engine",timestamp:new Date().toISOString()}],raw_event:{event_type:"process_creation",command_line:"powershell.exe -enc JABzACAAPQAgAE4AZQB3AC0ATwBiAGoAZQBjAHQAIABJAE8ALgBNAGUAbQBvAHIAeQBTAHQAcgBlAGEAbQAoAFsAQwBvAG4AdgBlAHIAdABdADoAOgBGAHIAbwBtAEIAYQBzAGUANgA0AFMAdAByAGkAbgBnACgAIgBIADQAcwBJAEAA",user:"NT AUTHORITY\\SYSTEM",parent_process:"cmd.exe"}}),c([{title:"Port Scan Detected",severity:"low",timestamp:new Date(Date.now()-36e5).toISOString(),src_ip:"192.168.1.105",dst_ip:"10.0.0.5",protocol:"TCP"},{title:"SMB Brute Force",severity:"medium",timestamp:new Date(Date.now()-18e5).toISOString(),src_ip:"192.168.1.105",dst_ip:"10.0.0.5",protocol:"SMB"},{title:"Suspicious PowerShell Activity",severity:"critical",timestamp:new Date().toISOString(),src_ip:"192.168.1.105",dst_ip:"10.0.0.5",protocol:"TCP"}])}finally{o(!1)}})()},[r]);const p=async a=>{try{await N.updateAlertStatus(r,a),i({...s,status:a})}catch(m){console.error("Failed to update status:",m)}},b=async()=>{if(u.trim())try{await N.addAlertNote(r,u),j("");const a=await N.getAlertById(r);i(a)}catch(a){console.error("Failed to add note:",a)}};if(x)return e.jsx("div",{className:"modal-overlay",children:e.jsx("div",{className:"alert-modal loading",children:e.jsx("div",{className:"loading-spinner",children:"Loading investigation..."})})});if(!s)return null;const _={critical:"#ef4444",high:"#f59e0b",medium:"#3b82f6",low:"#6b7280",info:"#94a3b8"};return e.jsx("div",{className:"modal-overlay",onClick:t,children:e.jsxs("div",{className:"alert-modal",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{className:"modal-title-section",children:[e.jsx(A,{className:"alert-icon",style:{color:_[s.severity]}}),e.jsxs("div",{children:[e.jsx("h2",{children:s.title||s.rule_name}),e.jsxs("div",{className:"alert-meta",children:[e.jsx("span",{className:`severity-badge ${s.severity}`,children:s.severity?.toUpperCase()}),e.jsxs("span",{className:"alert-id",children:["ID: ",s.id]}),e.jsxs("span",{className:"alert-time",children:[e.jsx(T,{className:"w-4 h-4"}),new Date(s.timestamp).toLocaleString()]})]})]})]}),e.jsx("button",{className:"close-btn",onClick:t,children:e.jsx(D,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"modal-tabs",children:[e.jsxs("button",{className:`tab ${h==="details"?"active":""}`,onClick:()=>n("details"),children:[e.jsx(v,{className:"w-4 h-4"}),"Details"]}),e.jsxs("button",{className:`tab ${h==="chain"?"active":""}`,onClick:()=>n("chain"),children:[e.jsx(C,{className:"w-4 h-4"}),"Attack Chain (",d.length,")"]}),e.jsxs("button",{className:`tab ${h==="notes"?"active":""}`,onClick:()=>n("notes"),children:[e.jsx(v,{className:"w-4 h-4"}),"Notes (",s.notes?.length||0,")"]})]}),e.jsxs("div",{className:"modal-content",children:[h==="details"&&e.jsxs("div",{className:"details-view",children:[e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Source IP"}),e.jsx("span",{className:"mono",children:s.src_ip||"N/A"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Destination IP"}),e.jsx("span",{className:"mono",children:s.dst_ip||"N/A"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Protocol"}),e.jsx("span",{children:s.protocol||"N/A"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Port"}),e.jsx("span",{children:s.dst_port||"N/A"})]}),e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Description"}),e.jsx("p",{children:s.description||"No description available"})]}),s.mitre_tactic&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"MITRE Tactic"}),e.jsx("span",{className:"mitre-badge",children:s.mitre_tactic})]}),s.mitre_technique&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"MITRE Technique"}),e.jsx("span",{className:"mitre-badge",children:s.mitre_technique})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Risk Score"}),e.jsxs("span",{className:"risk-score",children:[s.risk_score||0,"/100"]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Status"}),e.jsxs("select",{value:s.status||"open",onChange:a=>p(a.target.value),className:"status-select",children:[e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"investigating",children:"Investigating"}),e.jsx("option",{value:"resolved",children:"Resolved"}),e.jsx("option",{value:"false_positive",children:"False Positive"})]})]})]}),s.raw_event&&e.jsxs("div",{className:"raw-event",children:[e.jsx("label",{children:"Raw Event Data"}),e.jsx("pre",{children:JSON.stringify(s.raw_event,null,2)})]})]}),h==="chain"&&e.jsx("div",{className:"chain-view",children:d.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx($,{className:"w-12 h-12"}),e.jsx("p",{children:"No correlated alerts found"})]}):e.jsx("div",{className:"timeline",children:d.map((a,m)=>e.jsxs("div",{className:"timeline-item",children:[e.jsx("div",{className:"timeline-marker"}),e.jsxs("div",{className:"timeline-content",children:[e.jsxs("div",{className:"timeline-header",children:[e.jsx("span",{className:`severity-badge ${a.severity}`,children:a.severity}),e.jsx("span",{className:"timeline-time",children:new Date(a.timestamp).toLocaleString()})]}),e.jsx("h4",{children:a.title||a.rule_name}),e.jsxs("p",{className:"timeline-meta",children:[a.src_ip," → ",a.dst_ip," (",a.protocol,")"]})]})]},m))})}),h==="notes"&&e.jsxs("div",{className:"notes-view",children:[e.jsxs("div",{className:"add-note",children:[e.jsx("textarea",{value:u,onChange:a=>j(a.target.value),placeholder:"Add investigation notes...",rows:4}),e.jsx("button",{onClick:b,className:"btn-primary",children:"Add Note"})]}),e.jsx("div",{className:"notes-list",children:s.notes?.length>0?s.notes.map((a,m)=>e.jsxs("div",{className:"note-item",children:[e.jsxs("div",{className:"note-header",children:[e.jsx("span",{className:"note-author",children:a.author}),e.jsx("span",{className:"note-time",children:new Date(a.timestamp).toLocaleString()})]}),e.jsx("p",{className:"note-content",children:a.content})]},m)):e.jsxs("div",{className:"empty-state",children:[e.jsx(v,{className:"w-12 h-12"}),e.jsx("p",{children:"No notes yet"})]})})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn-secondary",onClick:t,children:"Close"}),e.jsxs("button",{className:"btn-danger",children:[e.jsx(A,{className:"w-4 h-4"}),"Escalate"]}),e.jsxs("button",{className:"btn-success",children:[e.jsx(E,{className:"w-4 h-4"}),"Mark Resolved"]})]})]})})}const J=Object.freeze(Object.defineProperty({__proto__:null,default:U},Symbol.toStringTag,{value:"Module"}));function F(){const[r,t]=l.useState(""),[s,i]=l.useState([]),[d,c]=l.useState(!1),[x,o]=l.useState("24h"),h=async n=>{if(n?.preventDefault(),!!r.trim()){c(!0);try{await new Promise(j=>setTimeout(j,800));const u=Array(10).fill(0).map((j,p)=>({id:`evt-${Date.now()}-${p}`,timestamp:new Date().toISOString(),source_ip:`192.168.1.${100+p}`,dest_ip:`10.0.0.${50+p}`,protocol:["TCP","UDP","HTTP","DNS"][Math.floor(Math.random()*4)],event_type:"network_connection",details:`Connection to external host on port ${80+p}`}));i(u)}catch(u){console.error("Search failed:",u)}finally{c(!1)}}};return e.jsxs("div",{className:"event-search-container",children:[e.jsxs("div",{className:"search-header",children:[e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx(f,{className:"search-icon"}),e.jsx("input",{type:"text",placeholder:"Search events (e.g. ip=192.168.1.1 OR protocol=HTTP)...",value:r,onChange:n=>t(n.target.value),onKeyDown:n=>n.key==="Enter"&&h()})]}),e.jsxs("div",{className:"search-controls",children:[e.jsxs("select",{value:x,onChange:n=>o(n.target.value),className:"time-select",children:[e.jsx("option",{value:"1h",children:"Last 1 Hour"}),e.jsx("option",{value:"24h",children:"Last 24 Hours"}),e.jsx("option",{value:"7d",children:"Last 7 Days"}),e.jsx("option",{value:"30d",children:"Last 30 Days"})]}),e.jsx("button",{className:"btn-icon",title:"Filter",children:e.jsx(k,{className:"w-4 h-4"})}),e.jsx("button",{className:"btn-primary",onClick:h,disabled:d,children:d?e.jsx(S,{size:"small"}):"Search"})]})]}),e.jsx("div",{className:"search-results",children:d?e.jsx(S,{size:"medium",message:"Searching events..."}):s.length>0?e.jsxs("div",{className:"results-section",children:[e.jsxs("div",{className:"results-header",children:[e.jsxs("span",{children:["Results: ",s.length," events"]}),e.jsxs("button",{className:"btn-export",children:[e.jsx(R,{className:"w-4 h-4"}),"Export"]})]}),e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Time"}),e.jsx("th",{children:"Source"}),e.jsx("th",{children:"Destination"}),e.jsx("th",{children:"Protocol"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Details"})]})}),e.jsx("tbody",{children:s.map(n=>e.jsxs("tr",{children:[e.jsx("td",{className:"mono text-sm",children:new Date(n.timestamp).toLocaleTimeString()}),e.jsx("td",{className:"mono text-cyan-400",children:n.source_ip}),e.jsx("td",{className:"mono text-cyan-400",children:n.dest_ip}),e.jsx("td",{children:e.jsx("span",{className:"protocol-tag",children:n.protocol})}),e.jsx("td",{children:n.event_type}),e.jsx("td",{className:"text-gray-400",children:n.details})]},n.id))})]})]}):e.jsxs("div",{className:"empty-search",children:[e.jsx(f,{className:"w-12 h-12 text-gray-700 mb-4"}),e.jsx("p",{children:"Enter a query to search security events"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Try searching for IPs, protocols, or event types"})]})})]})}const G=Object.freeze(Object.defineProperty({__proto__:null,default:F},Symbol.toStringTag,{value:"Module"}));function H(){const[r,t]=l.useState([]),[s,i]=l.useState(!1),[d,c]=l.useState({eps:0,total:0}),x=l.useRef(null);return l.useEffect(()=>{const o=setInterval(()=>{if(s)return;const h={id:Date.now(),timestamp:new Date,type:["DNS","HTTP","TLS","SSH","SMB"][Math.floor(Math.random()*5)],src:`192.168.1.${Math.floor(Math.random()*255)}`,dst:`10.0.0.${Math.floor(Math.random()*255)}`,info:"Traffic detected",severity:Math.random()>.9?"high":"info"};t(n=>[h,...n].slice(0,50)),c(n=>({eps:Math.floor(Math.random()*50)+10,total:n.total+1}))},1e3);return()=>clearInterval(o)},[s]),e.jsxs("div",{className:"feed-container",children:[e.jsxs("div",{className:"feed-header",children:[e.jsxs("div",{className:"feed-title",children:[e.jsx(I,{className:"w-4 h-4 text-green-400"}),e.jsx("h3",{children:"Live Event Stream"}),e.jsx("span",{className:"live-indicator",children:"LIVE"})]}),e.jsxs("div",{className:"feed-controls",children:[e.jsxs("span",{className:"feed-stat",children:[d.eps," EPS"]}),e.jsx("button",{className:"btn-icon-sm",onClick:()=>i(!s),title:s?"Resume":"Pause",children:s?e.jsx(B,{className:"w-3 h-3"}):e.jsx(L,{className:"w-3 h-3"})})]})]}),e.jsxs("div",{className:"feed-content",ref:x,children:[r.map(o=>e.jsxs("div",{className:`feed-item ${o.severity}`,children:[e.jsx("div",{className:"feed-time",children:o.timestamp.toLocaleTimeString()}),e.jsx("div",{className:"feed-type",children:o.type}),e.jsxs("div",{className:"feed-details",children:[e.jsx("span",{className:"feed-ip",children:o.src}),e.jsx("span",{className:"feed-arrow",children:"→"}),e.jsx("span",{className:"feed-ip",children:o.dst})]}),o.severity==="high"&&e.jsx(O,{className:"w-3 h-3 text-yellow-500"})]},o.id)),r.length===0&&e.jsx("div",{className:"feed-empty",children:"Waiting for events..."})]})]})}const V=Object.freeze(Object.defineProperty({__proto__:null,default:H},Symbol.toStringTag,{value:"Module"}));export{J as A,G as E,V as R};
