rule Webshell_Generic {
    meta:
        description = "Generic webshell detection"
        severity = "high"
        category = "webshell"
    
    strings:
        $php1 = "eval($_POST" nocase
        $php2 = "system($_GET" nocase
        $php3 = "base64_decode" nocase
        $php4 = "exec($_" nocase
        $php5 = "shell_exec" nocase
        $asp1 = "Execute(Request" nocase
        $asp2 = "eval request" nocase
        
    condition:
        any of them
}

rule Ransomware_Note {
    meta:
        description = "Ransomware readme/note file"
        severity = "critical"
        category = "ransomware"
    
    strings:
        $s1 = "bitcoin" nocase
        $s2 = "decrypt" nocase
        $s3 = "files have been encrypted" nocase
        $s4 = "payment" nocase
        $s5 = "ransom" nocase
        
    condition:
        3 of them
}

rule Reverse_Shell {
    meta:
        description = "Reverse shell script"
        severity = "high"
        category = "backdoor"
    
    strings:
        $s1 = "/bin/bash" nocase
        $s2 = "exec" nocase
        $s3 = "socket" nocase
        $s4 = "connect" nocase
        $py1 = "import socket" nocase
        $py2 = "subprocess" nocase
        
    condition:
        ($s1 and $s2 and $s3 and $s4) or ($py1 and $py2)
}

rule Mimikatz {
    meta:
        description = "Mimikatz credential dumper"
        severity = "critical"
        category = "credential_dumping"
    
    strings:
        $s1 = "sekurlsa::logonpasswords" nocase
        $s2 = "lsadump::sam" nocase
        $s3 = "kerberos::golden" nocase
        $s4 = "privilege::debug" nocase
        $s5 = "benjamin@gentilkiwi" nocase
        
    condition:
        any of them
}

rule Suspicious_PowerShell {
    meta:
        description = "Suspicious PowerShell script"
        severity = "medium"
        category = "execution"
    
    strings:
        $s1 = "Invoke-Expression" nocase
        $s2 = "DownloadString" nocase
        $s3 = "-enc" nocase
        $s4 = "-EncodedCommand" nocase
        $s5 = "FromBase64String" nocase
        $s6 = "Start-Process" nocase
        
    condition:
        2 of them
}

rule SQLi_Payload {
    meta:
        description = "SQL injection payload"
        severity = "high"
        category = "injection"
    
    strings:
        $s1 = "union select" nocase
        $s2 = "' or '1'='1" nocase
        $s3 = "exec xp_cmdshell" nocase
        $s4 = "'; drop table" nocase
        
    condition:
        any of them
}
