[sources.eve]
  type = "file"
  include = ["/var/lib/suricata/log/eve.json"]
  ignore_older_secs = 600
  fingerprinting.strategy = "device-and-position"

[transforms.decode_eve]
  type = "remap"
  inputs = ["eve"]
  source = '''
  . = parse_json!(.message)
  .sensor_id = env_get("SENSOR_ID") ?? "suricata-sensor"
  .tenant_id = env_get("TENANT_ID") ?? "default"
  .source_service = "suricata"
  .@timestamp = .timestamp ?? now()
  '''

[sinks.kafka]
  type = "kafka"
  inputs = ["decode_eve"]
  bootstrap_servers = "${KAFKA_BROKERS:-kafka:9092}"
  topic = "${KAFKA_TOPIC:-suricata-logs}"
  encoding.codec = "json"
  librdkafka_options."security.protocol" = "${KAFKA_SECURITY_PROTOCOL:-PLAINTEXT}"
  librdkafka_options."sasl.mechanisms" = "${KAFKA_SASL_MECHANISM:-}"
  librdkafka_options."sasl.username" = "${KAFKA_SASL_USERNAME:-}"
  librdkafka_options."sasl.password" = "${KAFKA_SASL_PASSWORD:-}"
  tls.enabled = ${KAFKA_TLS_ENABLED:-false}
  tls.ca_file = "${KAFKA_CA_PATH:-}"
  tls.crt_file = "${KAFKA_CERT_PATH:-}"
  tls.key_file = "${KAFKA_KEY_PATH:-}"
